<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSL-KDD Security Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #1a1c23; color: #e2e8f0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .card { background-color: #24262d; border: none; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); margin-bottom: 20px; }
        .card-header { background-color: #24262d; border-bottom: 1px solid #374151; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }
        .text-success-custom { color: #10b981; }
        .text-danger-custom { color: #ef4444; }
        .text-warning-custom { color: #f59e0b; }
        .stat-card h3 { font-size: 2.5rem; font-weight: bold; margin: 0; }
        .stat-card p { color: #9ca3af; margin: 0; }
        .table-dark { background-color: #24262d; --bs-table-bg: #24262d; color: #e2e8f0; border-color: #374151; }
        .badge-attack { background-color: #ef4444; color: white; padding: 5px 10px; border-radius: 4px; }
        .badge-normal { background-color: #10b981; color: white; padding: 5px 10px; border-radius: 4px; }
    </style>
</head>
<body>

<div class="container-fluid p-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold"><i class="fas fa-shield-alt text-primary"></i> Hệ Thống Phát Hiện Xâm Nhập (IDS)</h2>
            <small class="text-muted">Dữ liệu: NSL-KDD | Nền tảng: Apache Spark | Mô hình: LR & XGBoost</small>
        </div>
        <div>
            <span class="badge bg-success p-2"><i class="fas fa-check-circle"></i> Hệ thống Online</span>
        </div>
    </div>

    <div class="row">
        <div class="col-md-3">
            <div class="card p-3 stat-card">
                <div class="d-flex justify-content-between">
                    <div>
                        <p>Tổng Gói Tin</p>
                        <h3 id="total-traffic">148,517</h3>
                    </div>
                    <i class="fas fa-network-wired fa-2x text-primary"></i>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card p-3 stat-card">
                <div class="d-flex justify-content-between">
                    <div>
                        <p>Phát Hiện Tấn Công</p>
                        <h3 id="attacks-detected" class="text-danger-custom">77,054</h3>
                    </div>
                    <i class="fas fa-bug fa-2x text-danger-custom"></i>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card p-3 stat-card">
                <div class="d-flex justify-content-between">
                    <div>
                        <p>Gói Tin Sạch</p>
                        <h3 id="normal-traffic" class="text-success-custom">70,853</h3>
                    </div>
                    <i class="fas fa-shield-virus fa-2x text-success-custom"></i>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card p-3 stat-card">
                <div class="d-flex justify-content-between">
                    <div>
                        <p>Mô Hình Tốt Nhất</p>
                        <h3 class="text-warning-custom">XGBoost</h3>
                    </div>
                    <i class="fas fa-trophy fa-2x text-warning-custom"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">So Sánh Hiệu Suất Mô Hình (Spark Output)</div>
                <div class="card-body">
                    <canvas id="modelComparisonChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">Phân Phối Loại Tấn Công (Train Set)</div>
                <div class="card-body">
                    <canvas id="attackDistChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">Chi Tiết Kết Quả Đánh Giá (Evaluation Metrics)</div>
                <div class="card-body p-0">
                    <table class="table table-dark table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Mô hình</th>
                                <th>Accuracy (Độ chính xác)</th>
                                <th>Precision</th>
                                <th>Recall</th>
                                <th>F1-Score</th>
                                <th>Area Under ROC (AUC)</th>
                            </tr>
                        </thead>
                        <tbody id="results-table">
                            <tr>
                                <td>Logistic Regression</td>
                                <td class="text-warning">95.18%</td>
                                <td>95.18%</td>
                                <td>95.18%</td>
                                <td>95.18%</td>
                                <td>0.9886</td>
                            </tr>
                            <tr style="border-left: 4px solid #f59e0b;">
                                <td class="fw-bold">XGBoost (Spark) <i class="fas fa-star text-warning"></i></td>
                                <td class="text-success-custom fw-bold">98.74%</td>
                                <td>98.74%</td>
                                <td>98.74%</td>
                                <td>98.74%</td>
                                <td class="fw-bold">0.9992</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-satellite-dish"></i> Giám Sát Gói Tin Thời Gian Thực (Mô phỏng từ Test Data)
                </div>
                <div class="card-body p-0">
                    <table class="table table-dark table-striped mb-0">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Source Bytes</th>
                                <th>Protocol</th>
                                <th>Service</th>
                                <th>Flag</th>
                                <th>Dự đoán (XGBoost)</th>
                                <th>Trạng thái</th>
                            </tr>
                        </thead>
                        <tbody id="live-traffic-body">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Load dữ liệu từ file JSON nếu có
    async function loadResults() {
        try {
            const response = await fetch('results.json');
            if (response.ok) {
                const data = await response.json();
                updateDashboard(data);
            }
        } catch (error) {
            console.log('Sử dụng dữ liệu mặc định');
        }
    }

    function updateDashboard(data) {
        if (data.statistics) {
            document.getElementById('total-traffic').textContent = data.statistics.total.toLocaleString();
            document.getElementById('attacks-detected').textContent = data.statistics.attacks.toLocaleString();
            document.getElementById('normal-traffic').textContent = data.statistics.normal.toLocaleString();
        }

        if (data.models) {
            updateResultsTable(data.models);
            updateComparisonChart(data.models);
        }

        if (data.attack_distribution) {
            updateAttackChart(data.attack_distribution);
        }
    }

    function updateResultsTable(models) {
        const tbody = document.getElementById('results-table');
        tbody.innerHTML = '';
        
        models.forEach((model, index) => {
            const row = `
                <tr ${index === models.length - 1 ? 'style="border-left: 4px solid #f59e0b;"' : ''}>
                    <td class="${index === models.length - 1 ? 'fw-bold' : ''}">${model.name} ${index === models.length - 1 ? '<i class="fas fa-star text-warning"></i>' : ''}</td>
                    <td class="${index === models.length - 1 ? 'text-success-custom fw-bold' : 'text-warning'}">${(model.accuracy * 100).toFixed(2)}%</td>
                    <td>${(model.precision * 100).toFixed(2)}%</td>
                    <td>${(model.recall * 100).toFixed(2)}%</td>
                    <td>${(model.f1 * 100).toFixed(2)}%</td>
                    <td class="${index === models.length - 1 ? 'fw-bold' : ''}">${model.auc.toFixed(4)}</td>
                </tr>
            `;
            tbody.insertAdjacentHTML('beforeend', row);
        });
    }

    // --- 1. Biểu đồ So sánh Mô hình ---
    const ctxComparison = document.getElementById('modelComparisonChart').getContext('2d');
    const comparisonChart = new Chart(ctxComparison, {
        type: 'bar',
        data: {
            labels: ['Accuracy', 'Precision', 'Recall', 'F1-Score', 'AUC'],
            datasets: [
                {
                    label: 'Logistic Regression',
                    data: [0.9518, 0.9518, 0.9518, 0.9518, 0.9886],
                    backgroundColor: 'rgba(54, 162, 235, 0.6)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                },
                {
                    label: 'XGBoost',
                    data: [0.9874, 0.9874, 0.9874, 0.9874, 0.9992],
                    backgroundColor: 'rgba(255, 159, 64, 0.7)',
                    borderColor: 'rgba(255, 159, 64, 1)',
                    borderWidth: 1
                }
            ]
        },
        options: {
            responsive: true,
            scales: {
                y: { beginAtZero: true, max: 1.0 }
            },
            plugins: {
                legend: { labels: { color: 'white' } }
            }
        }
    });

    function updateComparisonChart(models) {
        if (models.length >= 2) {
            comparisonChart.data.datasets[0].data = [
                models[0].accuracy, models[0].precision, models[0].recall, models[0].f1, models[0].auc
            ];
            comparisonChart.data.datasets[1].data = [
                models[1].accuracy, models[1].precision, models[1].recall, models[1].f1, models[1].auc
            ];
            comparisonChart.update();
        }
    }

    // --- 2. Biểu đồ Phân phối Tấn Công ---
    const ctxPie = document.getElementById('attackDistChart').getContext('2d');
    const attackChart = new Chart(ctxPie, {
        type: 'doughnut',
        data: {
            labels: ['Normal', 'DoS', 'Probe', 'R2L', 'U2R'],
            datasets: [{
                data: [67343, 45927, 11656, 995, 52],
                backgroundColor: ['#10b981', '#ef4444', '#f59e0b', '#8b5cf6', '#ec4899'],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'right', labels: { color: 'white' } }
            }
        }
    });

    function updateAttackChart(distribution) {
        attackChart.data.labels = Object.keys(distribution);
        attackChart.data.datasets[0].data = Object.values(distribution);
        attackChart.update();
    }

    // --- 3. Script Giả lập Log Real-time ---
    const trafficTable = document.getElementById('live-traffic-body');
    const protocols = ['tcp', 'udp', 'icmp'];
    const services = ['http', 'private', 'ecr_i', 'smtp', 'ftp_data', 'domain_u', 'eco_i'];
    const flags = ['SF', 'S0', 'REJ', 'RSTO', 'SH'];
    const attackTypes = ['Neptune', 'Smurf', 'Satan', 'Portsweep', 'Normal'];

    function addRow() {
        const now = new Date().toLocaleTimeString();
        const isAttack = Math.random() > 0.52; // 48% attack rate theo NSL-KDD
        const protocol = protocols[Math.floor(Math.random() * protocols.length)];
        const service = services[Math.floor(Math.random() * services.length)];
        const flag = flags[Math.floor(Math.random() * flags.length)];
        const srcBytes = Math.floor(Math.random() * 5000);
        const attackType = isAttack ? attackTypes[Math.floor(Math.random() * (attackTypes.length - 1))] : 'Normal';
        
        const row = `
            <tr>
                <td>${now}</td>
                <td>${srcBytes}</td>
                <td><span class="badge bg-secondary">${protocol}</span></td>
                <td>${service}</td>
                <td>${flag}</td>
                <td class="fw-bold">${attackType}</td>
                <td>${isAttack ? '<span class="badge-attack">ALERT</span>' : '<span class="badge-normal">SAFE</span>'}</td>
            </tr>
        `;
        
        trafficTable.insertAdjacentHTML('afterbegin', row);
        if (trafficTable.children.length > 8) {
            trafficTable.removeChild(trafficTable.lastElementChild);
        }
    }

    // Khởi tạo
    loadResults();
    
    // Chạy giả lập mỗi 2 giây
    setInterval(addRow, 2000);
    addRow(); // Chạy ngay lần đầu
</script>

</body>
</html>